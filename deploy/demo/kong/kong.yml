##
##  Copyright (c) 2019-2021, ETH Zurich. All rights reserved.
##
##  Please, refer to the LICENSE file in the root directory.
##  SPDX-License-Identifier: BSD-3-Clause
##
_format_version: "1.1"

plugins:
- name: jwt
  # global plugin: applies to all request
  config:
    #_comment: "MUST add exp (expiration), not enabled by default"
    claims_to_verify: [exp]
- name: request-termination
  route: reject
  config:
    status_code: 400
    message: "Invalid"
- name: zipkin
  config:
    http_endpoint: http://192.168.220.50:9411/api/v2/spans
    sample_ratio: 1
    include_credential: true
    traceid_byte_count: 16
    header_type: preserve
    default_header_type: jaeger
#    tags_header: Zipkin-Tags

consumers:
  - username: default2  # name is irrelevant but required
    jwt_secrets:
    - key: http://localhost:8080/auth/realms/kcrealm
      algorithm: "RS256"
      rsa_public_key: "-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA56KU32nxDaZscFaw6nV/\njJnH+/qbj+oRob0N+eZbmhVdebNTN4clsLWlGhK0s2+miv8llKNfGgDkJLcK/m49\nIPDb9bOtjUXKSshbTXoJtzlWrabW0pCVnSNOQyiJUCGatrTFlFv3pZEzXarXzA2K\nz4CnUAhxG6C4rRsJJH9S6+tpwVZ9+KtjDki6NT/Gp2+q4eaW2Z1Ju6NfjZLuE1IE\nPCDvsdsnFnkipIwaKk/W4+cSRpCUHApfeccAucM8ddVy35vUuM5jknl/Az2ty4K3\nsTIT+3lNT1XpyRdr20R9zGTEQTmZG4o7WuCZkJtEb4zAu4jpMFTJbiUkUtzhfCv0\nGd+dAfqZzy+scms6V/NogbNPm8V6QxQQLXwrKPnP2YbcFVEqVh+3n02LdCEXnDgN\n90g8eoPQ0Bpm+LlDoVllVLVujBZTXez6xaKEvSPNxnJM2zSKje1mUXinUWURsCai\nH09d5vMYXYBMBXTtSOIHyLaApFFxLDBOnHIJxv2l60P7uE6HSkW3IlrpUp/AfRiH\n6ifSpuBOeRWt3mWowkul+LaAdf5LzFdRTm9d8Tt7hHgESbohXXPlM2FAaqDJKnLP\n2ZHkU394gwEUDGqRlQhOh+rVCS+Lyv36kjeuSmA+SdmMC68a/q6sDaO1jbjBI8Bw\nkmMlJR5fR9NAQ6iO/MJRsnMCAwEAAQ==\n-----END PUBLIC KEY-----"

routes:
- name: reject
  # rejects any undefined route with 'request-termination' plugin
  paths:
  - /
  - /tasks/tasklist

services:
- name: compute
  url: https://192.168.220.9:5006
  routes:
  - name: compute
    methods: [DELETE,GET,POST]
    paths:
    - /compute/
- name: status
  url: https://192.168.220.4:5001
  routes:
  - name: status
    methods: [GET]
    paths:
    - /status/
- name: storage
  url: https://192.168.220.5:5002
  routes:
  - name: storage
    methods: [GET,POST]
    paths:
    - /storage/
- name: tasks
  url: https://192.168.220.6:5003
  routes:
  - name: tasks
    methods: [GET]
    paths:
    - /tasks/
- name: utilities
  url: https://192.168.220.7:5004
  routes:
  - name: utilities
    methods: [DELETE,GET,POST,PUT]
    paths:
    - /utilities/
- name: reservations
  url: https://192.168.220.8:5005
  routes:
  - name: reservations
    methods: [DELETE,GET,POST,PUT]
    paths:
    - /reservations

